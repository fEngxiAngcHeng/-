/* ===========================================================
# bootstrap-tour - v0.9.3
# http://bootstraptour.com
# ==============================================================
# Copyright 2012-2013 Ulrich Sossou
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
*/
!(function(e,t){var n,r;r=t.document;n=function(){function n(n){var r;try{r=t.localStorage}catch(i){r=false}this._options=e.extend({name:"tour",steps:[],container:"body",keyboard:true,storage:r,debug:false,backdrop:false,redirect:true,orphan:false,duration:false,basePath:"",template:"<div class='popover'> <div class='arrow'></div> <h3 class='popover-title popover-title-primary'></h3> <div class='popover-content'></div> <div class='popover-navigation'> <div class='btn-group'> <button class='btn btn-sm btn-primary' data-role='prev'>&laquo; Prev</button> <button class='btn btn-sm btn-primary' data-role='next'>Next &raquo;</button> <button class='btn btn-sm btn-default' data-role='pause-resume' data-pause-text='Pause' data-resume-text='Resume'>Pause</button> </div> <button class='btn btn-sm btn-default' data-role='end'>End tour</button> </div> </div>",afterSetState:function(e,t){},afterGetState:function(e,t){},afterRemoveState:function(e){},onStart:function(e){},onEnd:function(e){},onShow:function(e){},onShown:function(e){},onHide:function(e){},onHidden:function(e){},onNext:function(e){},onPrev:function(e){},onPause:function(e,t){},onResume:function(e,t){}},n);this._force=false;this._inited=false;this.backdrop={overlay:null,$element:null,$background:null,backgroundShown:false,overlayElementShown:false};this}n.prototype.addSteps=function(e){var t,n,r;for(n=0,r=e.length;n<r;n++){t=e[n];this.addStep(t)}return this};n.prototype.addStep=function(e){this._options.steps.push(e);return this};n.prototype.getStep=function(t){if(this._options.steps[t]!=null){return e.extend({id:"step-"+t,path:"",placement:"right",title:"",content:"<p></p>",next:t===this._options.steps.length-1?-1:t+1,prev:t-1,animation:true,container:this._options.container,backdrop:this._options.backdrop,redirect:this._options.redirect,orphan:this._options.orphan,duration:this._options.duration,template:this._options.template,onShow:this._options.onShow,onShown:this._options.onShown,onHide:this._options.onHide,onHidden:this._options.onHidden,onNext:this._options.onNext,onPrev:this._options.onPrev,onPause:this._options.onPause,onResume:this._options.onResume},this._options.steps[t])}};n.prototype.init=function(e){this._force=e;if(this.ended()){this._debug("Tour ended, init prevented.");return this}this.setCurrentStep();this._initMouseNavigation();this._initKeyboardNavigation();this._onResize(function(e){return function(){return e.showStep(e._current)}}(this));if(this._current!==null){this.showStep(this._current)}this._inited=true;return this};n.prototype.start=function(e){var t;if(e==null){e=false}if(!this._inited){this.init(e)}if(this._current===null){t=this._makePromise(this._options.onStart!=null?this._options.onStart(this):void 0);this._callOnPromiseDone(t,this.showStep,0)}return this};n.prototype.next=function(){var e;e=this.hideStep(this._current);return this._callOnPromiseDone(e,this._showNextStep)};n.prototype.prev=function(){var e;e=this.hideStep(this._current);return this._callOnPromiseDone(e,this._showPrevStep)};n.prototype.goTo=function(e){var t;t=this.hideStep(this._current);return this._callOnPromiseDone(t,this.showStep,e)};n.prototype.end=function(){var n,i;n=function(n){return function(i){e(r).off("click.tour-"+n._options.name);e(r).off("keyup.tour-"+n._options.name);e(t).off("resize.tour-"+n._options.name);n._setState("end","yes");n._inited=false;n._force=false;n._clearTimer();if(n._options.onEnd!=null){return n._options.onEnd(n)}}}(this);i=this.hideStep(this._current);return this._callOnPromiseDone(i,n)};n.prototype.ended=function(){return!this._force&&!!this._getState("end")};n.prototype.restart=function(){this._removeState("current_step");this._removeState("end");return this.start()};n.prototype.pause=function(){var e;e=this.getStep(this._current);if(!(e&&e.duration)){return this}this._paused=true;this._duration-=(new Date).getTime()-this._start;t.clearTimeout(this._timer);this._debug("Paused/Stopped step "+(this._current+1)+" timer ("+this._duration+" remaining).");if(e.onPause!=null){return e.onPause(this,this._duration)}};n.prototype.resume=function(){var e;e=this.getStep(this._current);if(!(e&&e.duration)){return this}this._paused=false;this._start=(new Date).getTime();this._duration=this._duration||e.duration;this._timer=t.setTimeout(function(e){return function(){if(e._isLast()){return e.next()}else{return e.end()}}}(this),this._duration);this._debug("Started step "+(this._current+1)+" timer with duration "+this._duration);if(e.onResume!=null&&this._duration!==e.duration){return e.onResume(this,this._duration)}};n.prototype.hideStep=function(t){var n,r,i;i=this.getStep(t);if(!i){return}this._clearTimer();r=this._makePromise(i.onHide!=null?i.onHide(this,t):void 0);n=function(n){return function(r){var s;s=e(i.element);if(!(s.data("bs.popover")||s.data("popover"))){s=e("body")}s.popover("destroy").removeClass("tour-"+n._options.name+"-element tour-"+n._options.name+"-"+t+"-element");if(i.reflex){s.css("cursor","").off("click.tour-"+n._options.name)}if(i.backdrop){n._hideBackdrop()}if(i.onHidden!=null){return i.onHidden(n)}}}(this);this._callOnPromiseDone(r,n);return r};n.prototype.showStep=function(e){var t,n,i,s;if(this.ended()){this._debug("Tour ended, showStep prevented.");return this}s=this.getStep(e);if(!s){return}i=e<this._current;t=this._makePromise(s.onShow!=null?s.onShow(this,e):void 0);n=function(t){return function(n){var o,u;t.setCurrentStep(e);u=function(){switch({}.toString.call(s.path)){case"[object Function]":return s.path();case"[object String]":return this._options.basePath+s.path;default:return s.path}}.call(t);o=[r.location.pathname,r.location.hash].join("");if(t._isRedirect(u,o)){t._redirect(s,u);return}if(t._isOrphan(s)){if(!s.orphan){t._debug("Skip the orphan step "+(t._current+1)+". Orphan option is false and the element doesn't exist or is hidden.");if(i){t._showPrevStep()}else{t._showNextStep()}return}t._debug("Show the orphan step "+(t._current+1)+". Orphans option is true.")}if(s.backdrop){t._showBackdrop(!t._isOrphan(s)?s.element:void 0)}t._scrollIntoView(s.element,function(){if(t.getCurrentStep()!==e){return}if(s.element!=null&&s.backdrop){t._showOverlayElement(s.element)}t._showPopover(s,e);if(s.onShown!=null){s.onShown(t)}return t._debug("Step "+(t._current+1)+" of "+t._options.steps.length)});if(s.duration){return t.resume()}}}(this);this._callOnPromiseDone(t,n);return t};n.prototype.getCurrentStep=function(){return this._current};n.prototype.setCurrentStep=function(e){if(e!=null){this._current=e;this._setState("current_step",e)}else{this._current=this._getState("current_step");this._current=this._current===null?null:parseInt(this._current,10)}return this};n.prototype._setState=function(e,t){var n,r;if(this._options.storage){r=""+this._options.name+"_"+e;try{this._options.storage.setItem(r,t)}catch(i){n=i;if(n.code===DOMException.QUOTA_EXCEEDED_ERR){this.debug("LocalStorage quota exceeded. State storage failed.")}}return this._options.afterSetState(r,t)}else{if(this._state==null){this._state={}}return this._state[e]=t}};n.prototype._removeState=function(e){var t;if(this._options.storage){t=""+this._options.name+"_"+e;this._options.storage.removeItem(t);return this._options.afterRemoveState(t)}else{if(this._state!=null){return delete this._state[e]}}};n.prototype._getState=function(e){var t,n;if(this._options.storage){t=""+this._options.name+"_"+e;n=this._options.storage.getItem(t)}else{if(this._state!=null){n=this._state[e]}}if(n===void 0||n==="null"){n=null}this._options.afterGetState(e,n);return n};n.prototype._showNextStep=function(){var e,t,n;n=this.getStep(this._current);t=function(e){return function(t){return e.showStep(n.next)}}(this);e=this._makePromise(n.onNext!=null?n.onNext(this):void 0);return this._callOnPromiseDone(e,t)};n.prototype._showPrevStep=function(){var e,t,n;n=this.getStep(this._current);t=function(e){return function(t){return e.showStep(n.prev)}}(this);e=this._makePromise(n.onPrev!=null?n.onPrev(this):void 0);return this._callOnPromiseDone(e,t)};n.prototype._debug=function(e){if(this._options.debug){return t.console.log("Bootstrap Tour '"+this._options.name+"' | "+e)}};n.prototype._isRedirect=function(e,t){return e!=null&&e!==""&&({}.toString.call(e)==="[object RegExp]"&&!e.test(t)||{}.toString.call(e)==="[object String]"&&e.replace(/\?.*$/,"").replace(/\/?$/,"")!==t.replace(/\/?$/,""))};n.prototype._redirect=function(t,n){if(e.isFunction(t.redirect)){return t.redirect.call(this,n)}else if(t.redirect===true){this._debug("Redirect to "+n);return r.location.href=n}};n.prototype._isOrphan=function(t){return t.element==null||!e(t.element).length||e(t.element).is(":hidden")&&e(t.element)[0].namespaceURI!=="http://www.w3.org/2000/svg"};n.prototype._isLast=function(){return this._current<this._options.steps.length-1};n.prototype._showPopover=function(t,n){var r,i,s,o,u,a;e(".tour-"+this._options.name).remove();a=e.extend({},this._options);s=e.isFunction(t.template)?e(t.template(n,t)):e(t.template);i=s.find(".popover-navigation");u=this._isOrphan(t);if(u){t.element="body";t.placement="top";s=s.addClass("orphan")}r=e(t.element);s.addClass("tour-"+this._options.name+" tour-"+this._options.name+"-"+n);r.addClass("tour-"+this._options.name+"-element tour-"+this._options.name+"-"+n+"-element");if(t.options){e.extend(a,t.options)}if(t.reflex&&!u){r.css("cursor","pointer").on("click.tour-"+this._options.name,function(e){return function(){if(e._isLast()){return e.next()}else{return e.end()}}}(this))}if(t.prev<0){i.find("[data-role='prev']").addClass("disabled")}if(t.next<0){i.find("[data-role='next']").addClass("disabled")}if(!t.duration){i.find("[data-role='pause-resume']").remove()}t.template=s.clone().wrap("<div>").parent().html();r.popover({placement:t.placement,trigger:"manual",title:t.title,content:t.content,html:true,animation:t.animation,container:t.container,template:t.template,selector:t.element}).popover("show");o=r.data("bs.popover")?r.data("bs.popover").tip():r.data("popover").tip();o.attr("id",t.id);this._reposition(o,t);if(u){return this._center(o)}};n.prototype._reposition=function(t,n){var i,s,o,u,a,f,l;u=t[0].offsetWidth;s=t[0].offsetHeight;l=t.offset();a=l.left;f=l.top;i=e(r).outerHeight()-l.top-t.outerHeight();if(i<0){l.top=l.top+i}o=e("html").outerWidth()-l.left-t.outerWidth();if(o<0){l.left=l.left+o}if(l.top<0){l.top=0}if(l.left<0){l.left=0}t.offset(l);if(n.placement==="bottom"||n.placement==="top"){if(a!==l.left){return this._replaceArrow(t,(l.left-a)*2,u,"left")}}else{if(f!==l.top){return this._replaceArrow(t,(l.top-f)*2,s,"top")}}};n.prototype._center=function(n){return n.css("top",e(t).outerHeight()/2-n.outerHeight()/2)};n.prototype._replaceArrow=function(e,t,n,r){return e.find(".arrow").css(r,t?50*(1-t/n)+"%":"")};n.prototype._scrollIntoView=function(n,r){var i,s,o,u,a,f;i=e(n);if(!i.length){return r()}s=e(t);u=i.offset().top;f=s.height();a=Math.max(0,u-f/2);this._debug("Scroll into view. ScrollTop: "+a+". Element offset: "+u+". Window height: "+f+".");o=0;return e("body,html").stop(true,true).animate({scrollTop:Math.ceil(a)},function(e){return function(){if(++o===2){r();return e._debug("Scroll into view. Animation end element offset: "+i.offset().top+". Window height: "+s.height()+".")}}}(this))};n.prototype._onResize=function(n,r){return e(t).on("resize.tour-"+this._options.name,function(){clearTimeout(r);return r=setTimeout(n,100)})};n.prototype._initMouseNavigation=function(){var t;t=this;return e(r).off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='prev']:not(.disabled)").off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='next']:not(.disabled)").off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='end']").off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='pause-resume']").on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='next']:not(.disabled)",function(e){return function(t){t.preventDefault();return e.next()}}(this)).on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='prev']:not(.disabled)",function(e){return function(t){t.preventDefault();return e.prev()}}(this)).on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='end']",function(e){return function(t){t.preventDefault();return e.end()}}(this)).on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='pause-resume']",function(n){var r;n.preventDefault();r=e(this);r.text(t._paused?r.data("pause-text"):r.data("resume-text"));if(t._paused){return t.resume()}else{return t.pause()}})};n.prototype._initKeyboardNavigation=function(){if(!this._options.keyboard){return}return e(r).on("keyup.tour-"+this._options.name,function(e){return function(t){if(!t.which){return}switch(t.which){case 39:t.preventDefault();if(e._isLast()){return e.next()}else{return e.end()}break;case 37:t.preventDefault();if(e._current>0){return e.prev()}break;case 27:t.preventDefault();return e.end()}}}(this))};n.prototype._makePromise=function(t){if(t&&e.isFunction(t.then)){return t}else{return null}};n.prototype._callOnPromiseDone=function(e,t,n){if(e){return e.then(function(e){return function(r){return t.call(e,n)}}(this))}else{return t.call(this,n)}};n.prototype._showBackdrop=function(t){if(this.backdrop.backgroundShown){return}this.backdrop=e("<div/>",{"class":"tour-backdrop"});this.backdrop.backgroundShown=true;return e("body").append(this.backdrop)};n.prototype._hideBackdrop=function(){this._hideOverlayElement();return this._hideBackground()};n.prototype._hideBackground=function(){if(this.backdrop){this.backdrop.remove();this.backdrop.overlay=null;return this.backdrop.backgroundShown=false}};n.prototype._showOverlayElement=function(t){var n,r,i;r=e(t);if(!r||r.length===0||this.backdrop.overlayElementShown){return}this.backdrop.overlayElementShown=true;n=e("<div/>");i=r.offset();i.top=i.top;i.left=i.left;n.width(r.innerWidth()).height(r.innerHeight()).addClass("tour-step-background").offset(i);r.addClass("tour-step-backdrop");e("body").append(n);this.backdrop.$element=r;return this.backdrop.$background=n};n.prototype._hideOverlayElement=function(){if(!this.backdrop.overlayElementShown){return}this.backdrop.$element.removeClass("tour-step-backdrop");this.backdrop.$background.remove();this.backdrop.$element=null;this.backdrop.$background=null;return this.backdrop.overlayElementShown=false};n.prototype._clearTimer=function(){t.clearTimeout(this._timer);this._timer=null;return this._duration=null};return n}();return t.Tour=n})(jQuery,window)